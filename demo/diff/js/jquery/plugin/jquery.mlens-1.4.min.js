/*! jquery.mlens.js - magnifying lens jQuery plugin for images by Federica Sibella (@musings.it) - Double licensed MIT and GPLv3 */
!function(e){function t(e){if("string"==typeof e){var t=e.indexOf("_");-1!=t&&(e=e.substr(t+1))}return e}var r=[],i=0,o={init:function(t){var o={lensShape:"square",lensSize:100,borderSize:4,borderColor:"#888",borderRadius:0,imgSrc:"",imgSrc2x:"",lensCss:"",imgOverlay:"",overlayAdapt:!0,zoomLevel:1},n=e.extend({},o,t);this.each(function(){var t=e(this),a=t.data("mlens"),s=e(),d=e(),c=e(),g=e(),u=t.attr("src"),l="auto";if(("number"!=typeof n.zoomLevel||n.zoomLevel<=0)&&(n.zoomLevel=o.zoomLevel),""!=n.imgSrc2x&&window.devicePixelRatio>1){u=n.imgSrc2x;var p=new Image;p.onload=function(){l=String(parseInt(this.width/2)*n.zoomLevel)+"px",s.css({backgroundSize:l+" auto"}),g.css({width:l})},p.src=u}else{""!=n.imgSrc&&(u=n.imgSrc);var p=new Image;p.onload=function(){l=String(parseInt(this.width)*n.zoomLevel)+"px",s.css({backgroundSize:l+" auto"}),g.css({width:l})},p.src=u}var h="background-position: 0px 0px;width: "+String(n.lensSize)+"px;height: "+String(n.lensSize)+"px;float: left;display: none;border: "+String(n.borderSize)+"px solid "+n.borderColor+";background-repeat: no-repeat;position: absolute;",m="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";switch(n.overlayAdapt===!0&&(m+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),n.lensShape){case"square":case"":default:h=h+"border-radius:"+String(n.borderRadius)+"px;",m=m+"border-radius:"+String(n.borderRadius)+"px;";break;case"circle":h=h+"border-radius: "+String(n.lensSize/2+n.borderSize)+"px;",m=m+"border-radius: "+String(n.lensSize/2+n.borderSize)+"px;"}return t.wrap("<div id='mlens_wrapper_"+i+"' />"),c=t.parent(),c.css({width:t.width()}),s=e("<div id='mlens_target_"+i+"' style='"+h+"' class='"+n.lensCss+"'>&nbsp;</div>").appendTo(c),s.css({backgroundImage:"url('"+u+"')",backgroundSize:l+" auto",cursor:"none"}),g=e("<img style='display:none;width:"+l+";height:auto;max-width:none;max-height;none;' src='"+u+"' />").appendTo(c),""!=n.imgOverlay&&(d=e("<div id='mlens_overlay_"+i+"' style='"+m+"'>&nbsp;</div>"),d.css({backgroundImage:"url('"+n.imgOverlay+"')",cursor:"none"}),d.appendTo(s)),t.attr("data-id","mlens_"+i),s.mousemove(function(r){e.fn.mlens("move",t.attr("data-id"),r)}),t.mousemove(function(r){e.fn.mlens("move",t.attr("data-id"),r)}),s.on("touchmove",function(r){r.preventDefault();var i=r.originalEvent.touches[0]||r.originalEvent.changedTouches[0];e.fn.mlens("move",t.attr("data-id"),i)}),t.on("touchmove",function(r){r.preventDefault();var i=r.originalEvent.touches[0]||r.originalEvent.changedTouches[0];e.fn.mlens("move",t.attr("data-id"),i)}),s.hover(function(){e(this).show()},function(){e(this).hide()}),t.hover(function(){s.show()},function(){s.hide()}),s.on("touchstart",function(t){t.preventDefault(),e(this).show()}),s.on("touchend",function(t){t.preventDefault(),e(this).hide()}),t.on("touchstart",function(e){e.preventDefault(),s.show()}),t.on("touchend",function(e){e.preventDefault(),s.hide()}),t.data("mlens",{image:t,settings:n,target:s,imageTag:g,imgSrc:u,imgWidth:l,imageWrapper:c,overlay:d,instance:i}),a=t.data("mlens"),r[i]=a,i++,r})},move:function(e,i){e=t(e);var o=r[e],n=o.image,a=o.target,s=o.imageTag,d=n.offset(),c=parseInt(i.pageX-d.left),g=parseInt(i.pageY-d.top),u=s.width()/n.width(),l=s.height()/n.height();return c>0&&g>0&&c<n.width()&&g<n.height()&&(c=String(-((i.pageX-d.left)*u-a.width()/2)),g=String(-((i.pageY-d.top)*l-a.height()/2)),a.css({backgroundPosition:c+"px "+g+"px"}),c=String(i.pageX-d.left-a.width()/2),g=String(i.pageY-d.top-a.height()/2),a.css({left:c+"px",top:g+"px"})),o.target=a,r[e]=o,r},update:function(i){var o=t(e(this).attr("data-id")),n=r[o],a=n.image,s=n.target,d=n.overlay,c=n.imageTag,g=n.imgSrc,u=n.settings,l=e.extend({},u,i),p="auto";if(""!=l.imgSrc2x&&window.devicePixelRatio>1){g=l.imgSrc2x;var h=new Image;h.onload=function(){p=String(parseInt(this.width/2))+"px",s.css({backgroundSize:p+" auto"}),c.css({width:p})},h.src=g}else{""!=l.imgSrc&&(g=l.imgSrc);var h=new Image;h.onload=function(){p=String(parseInt(this.width)*l.zoomLevel)+"px",s.css({backgroundSize:p+" auto"}),c.css({width:p})},h.src=g}var m="background-position: 0px 0px;width: "+String(l.lensSize)+"px;height: "+String(l.lensSize)+"px;float: left;display: none;border: "+String(l.borderSize)+"px solid "+l.borderColor+";background-repeat: no-repeat;position: absolute;",v="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";switch(l.overlayAdapt===!0&&(v+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),l.lensShape){case"square":case"":default:m=m+"border-radius:"+String(l.borderRadius)+"px;",v=v+"border-radius:"+String(l.borderRadius)+"px;";break;case"circle":m=m+"border-radius: "+String(l.lensSize/2+l.borderSize)+"px;",v=v+"border-radius: "+String(l.lensSize/2+l.borderSize)+"px;"}return s.attr("style",m),c.attr("src",g),c.css({width:p}),s.css({backgroundImage:"url('"+g+"')",backgroundSize:p+" auto",cursor:"none"}),d.attr("style",v),d.css({backgroundImage:"url('"+l.imgOverlay+"')",cursor:"none"}),n.image=a,n.target=s,n.overlay=d,n.settings=l,n.imgSrc=g,n.imageTag=c,r[o]=n,r},destroy:function(){var i=t(e(this).attr("data-id")),o=r[i];o.target.remove(),o.imageTag.remove(),o.imageWrapper.remove(),o.overlay.remove(),e.removeData(o,"mlens"),this.unbind(),this.element=null}};e.fn.mlens=function(t){return o[t]?o[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.mlens"):o.init.apply(this,arguments)}}(jQuery);