<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

		<title>4what - JavaScript</title>

		<link rel="stylesheet" type="text/css" href="../../../css/sample.css" />

		<script type="text/javascript" src="../../../js/util.js"></script>
		<script type="text/javascript" src="../../../js/commons.js"></script>
	</head>
	<body>
		<h2><span>Specification</span></h2>
			<p>
				<a href="https://html.spec.whatwg.org/multipage/web-messaging.html">[1]</a>
				<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">[2]</a>
			</p>

		<h2><span>Compatibility</span></h2>
			<p>
				IE8+,
				Std
			</p>

		<h2><span>Syntax</span></h2>
			<textarea cols="" rows="" name="code" class="js">
				<script type="text/javascript">
					var iframe = document.createElement("iframe");
					iframe.src = "http://a.example.com:8080/index/studio/projects/4what.cn/lab/JavaScript/Window.postMessage/iframe.html";
					iframe.style.display = "none";

					document.body.appendChild(iframe);

					iframe.onload = function () {
						iframe.contentWindow.postMessage("Hello, World!", "http://a.example.com:8080");
					};

					function receiver(e) {
						if (e.origin !== "http://a.example.com:8080") {
							return;
						}

						alert("[RESPONSE] " + e.data + " (" + e.origin + ")");
					}

					$js.bind(window, "message", receiver);
				</script>
			</textarea>

		<h3>iframe.html</h3>
			<textarea cols="" rows="" name="code" class="js">
				<script type="text/javascript">
					function receiver(e) {
						if (e.origin !== "http://example.com:8080") {
							return;
						}

						alert("[REQUEST] " + e.data + " (" + e.origin + ")");

						e.source.postMessage("OK", e.origin);
					}

					$js.bind(window, "message", receiver);
				</script>
			</textarea>

		<h2><span>Example</span></h2>
			<script type="text/javascript">
				var iframe = document.createElement("iframe");
				iframe.src = "http://a.example.com:8080/index/studio/projects/4what.cn/lab/JavaScript/Window.postMessage/iframe.html";
				iframe.style.display = "none";

				document.body.appendChild(iframe);

				iframe.onload = function () {
					iframe.contentWindow.postMessage("Hello, World!", "http://a.example.com:8080");
				};

				function receiver(e) {
					if (e.origin !== "http://a.example.com:8080") {
						return;
					}

					alert("[RESPONSE] " + e.data + " (" + e.origin + ")");
				}

				$js.bind(window, "message", receiver);
			</script>

		<script type="text/javascript">
			(function () {

				$4what.syntaxhighlighter("../../../");

			})();
		</script>

		<script type="text/javascript" src="../../../js/analytics.js"></script>
	</body>
</html>
