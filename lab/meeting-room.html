<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title></title>
	<meta name="author" content="4what" />

	<style type="text/css">
	@import url("../css/reset.css");

	body {
		color: #333;
		font-family: sans-serif;
		font-size: 12px;
		margin: 15px 10px;
		/*
		word-break: break-all;
		word-wrap: break-word;
		*/
	}

	a:link {
	}
	a:visited {
	}
	a:hover {
	}
	a:active {
	}

	input, select, textarea {
		font-family: sans-serif;
		font-size: 12px;
	}


	/**/
	#schedule {
		text-align: center;
	}

	#schedule table {
		margin: 20px auto;
	}
	#schedule td {
		padding: 10px 5px;
	}

	#schedule ul.row {
		border-color: #808080;
		border-style: solid;
		border-width: 1px 1px 1px 0;
		float: left;
		list-style: none;
	}
	#schedule ul.row li {
		border-left: 1px solid #808080;
		cursor: pointer;
		float: left;
		height: 20px;
		margin: 0;
		width: 20px;
	}
	#schedule ul.row li.highlight {
		background: #9acd32;
	}
	#schedule ul.row li.dimmed {
		background: #ddd;
	}
	#schedule ul.row li.error {
		background: #ffb6c1;
	}
	#schedule ul.row li.opacity {
		filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50);
		opacity: 0.5;
	}

	#schedule ul.row li.color {
		background: #eee;
	}
	</style>
</head>
<body>
<div id="schedule">
	<button id="schedule-submit">Submit</button>
	<button id="schedule-reset">Reset</button>
	<button id="schedule-reload">Reload</button>

	<table>
		<caption>北京</caption>
		<tr>
			<td>
				<input type="radio" name="bj" value="" class="toggle" />
			</td>
			<td>
				<ul class="row">
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
				</ul>
			</td>
		</tr>
	</table>

	<table>
		<caption>上海</caption>
		<tr>
			<td>
				<input type="radio" name="sh" value="" class="toggle" />
			</td>
			<td>
				<ul class="row">
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li class="dimmed">&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
				</ul>
			</td>
		</tr>
		<tr>
			<td>
				<input type="radio" name="sh" value="" class="toggle" />
			</td>
			<td>
				<ul class="row">
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
				</ul>
			</td>
		</tr>
	</table>

	<table>
		<caption>广州</caption>
		<tr>
			<td>
				<input type="radio" name="gz" value="" class="toggle" />
			</td>
			<td>
				<ul class="row">
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
				</ul>
			</td>
		</tr>
	</table>

	<table>
		<caption>其他</caption>
		<tr>
			<td>
				<input type="radio" name="other" value="" class="toggle" />
			</td>
			<td>
				<ul class="row">
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
					<li>&nbsp;</li>
				</ul>
			</td>
		</tr>
	</table>
</div>

<script type="text/javascript" src="../js/jquery/jquery-1.8.3.min.js"></script>

<script type="text/javascript" src="../js/util.js"></script>

<script type="text/javascript">
(function() {

	/**
	 * @author 4what
	 * @requires jQuery 1.4.4+, $js
	 */
	var schedule = {
		result: [],

		/**
		 * @param {Object} options
		 */
		init: function(options) {
			var
			self = this,

			defaults = {
				box: $("#schedule"), // {Object|String}
				data: null, // {Object[][]} [[{"time": [0, 23], "msg": "", "style": ""}, ...], ...]
				msg: new Function("msg", ""), // {Function}
				reset: "" // {Object|String}
			},
			settings = $.extend(defaults, options),

			start = false,
			end = false,

			warning = false,

			idle = [],
			locked = [],

			target, cells,

			box = $(settings.box),

			rooms = box.find("ul.row"),
			li = "li",

			toggle = box.find("input.toggle");

			/* reset */
			function reset() {
				rooms.find(li).removeClass("highlight error opacity");
				start = false;
				end = false;
				warning = false;
				self.result = [];
			}

			/* clear */
			function clear() {
				toggle.attr("checked", false);
				for (var i = idle.length - 1; i >= 0; i--) {
					idle[i] = false;
				}
			}

			clear();

			$(settings.reset).click(function() {
				reset();
				clear();
			});

			/* toggle */
			toggle.each(function() {
				$(this).click(function() {
					toggle.each(function(i) {
						idle[i] = $(this).is(":checked");
					});

					target = rooms.filter(function(i) {
						return idle[i] === true;
					});

					cells = target.find(li);

					locked = $js.unique(cells.filter(".dimmed").map(function() {
						return $(this).index();
					}).get());

					rooms.filter(function(i) {
						return idle[i] === false;
					}).find(li).removeClass("highlight error opacity");

					if (start !== false && end === false && $.inArray(start, locked) === -1) {
						target.each(function() {
							$(this).find(li).eq(start).addClass("highlight");
						});
					} else if (end !== false) {
						var error = false;
						for (var i = start; i <= end; i++) {
							if ($.inArray(i, locked) !== -1) {
								error = true;
								break;
							}
						}
						if (error === false) {
							target.each(function() {
								$(this).find(li).slice(start, end + 1).addClass("highlight");
							});
						} else {
							reset();
						}
					} else {
						reset();
					}
				});
			});

			/* init */
			rooms.each(function(index) {
				idle[index] = false;

				$(this).find(li).each(function(i) {
					$(this).mouseenter(function() {
						if (idle[index] && start !== false && end === false && i >= start) {
							var error = $.grep(locked, function(element) {
								return element >= start
							})[0];
							warning = i >= error;

							target.each(function() {
								var items = $(this).find(li);

								items.removeClass("highlight error opacity")
								.slice(start, i + 1).addClass("highlight").not(":first").addClass("opacity");

								if (warning) {
									items.slice(error, i + 1).addClass("error");
								}
							});
						}
					}).click(function() {
						if (idle[index] && !warning) {
							if (start === false) {
								if ($.inArray(i, locked) === -1) {
									target.each(function() {
										$(this).find(li).eq(i).addClass("highlight");
									});
									start = i;
								}
							} else {
								if (end === false) {
									if (start === i) {
										cells.removeClass("highlight");
										start = false;
									} else if (i > start) {
										cells.removeClass("opacity");
										end = i;
										self.result = [start, end];
									}
								} else {
									if (i > start) {
										end = false;
										self.result = [];
										$(this).mouseenter();
									}
								}
							}
						}
					});
				});
			}).mouseleave(function() {
/*
				if (end === false) {
					target.each(function() {
						$(this).find(cell).slice(start + 1).removeClass("highlight error opacity");
					});
				}
*/
			});

			/* load */
			self.load = function(data) {
				if (data) {
					reset();
					clear();
					rooms.find(li).removeClass().removeData("msg");

					/* data */
					var style, time;
					for (var items, i = data.length - 1; i >= 0; i--) {
						items = data[i];
						for (var item, j = items.length - 1; j >= 0; j--) {
							item = items[j];
							style = item.style;
							time = item.time;
							for (var k = time[0]; k <= time[1]; k++) {
								rooms.eq(i).find(li).eq(k).addClass("dimmed" + (style ? " " + style : "")).data("msg", item.msg).unbind("click").bind("click", function() {
									var msg = $(this).data("msg");
									if (msg) {
										settings.msg(msg);
									}
								});
							}
						}
					}
				}
			};

			self.load(settings.data);
		}
	};

	/* init */
	schedule.init({
		//box: $("#schedule"),
/*
		data: [
			[{
				msg: "Apple",
				style: "color",
				time: [2, 5]
			}, {
				msg: "Google",
				style: "",
				time: [8, 13]
			}],
			[],
			[],
			[],
			[]
		],
*/
		msg: function(msg) {
			alert(msg);
		},
		reset: $("#schedule-reset")
	});

	/* submit */
	$("#schedule-submit").click(function() {
		alert(schedule.result);
	});

	/* reload */
	$("#schedule-reload").click(function() {
		schedule.load([
			[],
			[{
				time: [0, 39],
				msg: "Microsoft",
				style: ""
			}],
			[],
			[],
			[]
		]);
	});

})();
</script>

<script type="text/javascript" src="../js/analytics.js"></script>
</body>
</html>
